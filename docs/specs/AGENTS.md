# Инструкции для агентов: Создание спецификаций функциональных требований

## Назначение документа

Данный документ содержит точные инструкции для LLM-агентов по созданию детальных спецификаций функциональных требований в рамках проекта Card Limit Manager. Все спецификации должны соответствовать единому стандарту качества и структуре.

## Структура спецификации

Каждая спецификация ДОЛЖНА содержать следующие разделы в указанном порядке:

### 1. Обзор
- Краткое описание функциональности в 1-2 предложениях
- Указание цели и ценности для бизнеса

### 2. Ссылка на требование
- Точная цитата требования из `docs/requirements.md`
- Формат: `**R-X**: [текст требования]`

### 3. Заинтересованные стороны
- Полный список участников процесса
- Используйте роли: Сотрудник, Тим-лид, Риск-офицер, CFO, Администратор, Система

### 4. Предусловия
- Состояние системы и пользователя ПЕРЕД выполнением сценария
- Обязательные условия для возможности выполнения функции
- Включите аутентификацию, авторизацию, состояние данных

### 5. Постусловия
- **Успех**: Конечное состояние системы при успешном выполнении
- **Неудача**: Состояние системы при ошибке выполнения
- Укажите изменения в базе данных, уведомления, логирование

### 6. Основной сценарий (Happy Path)
- Таблица с колонками: # | Actor | Действие | Система | Данные | Схема/Контракт
- Каждый шаг пронумерован
- Указываются конкретные данные и ссылки на схемы OpenAPI
- Учитывайте валидацию, создание записей, формирование ответов

### 7. Альтернативные сценарии
- Все возможные ошибочные ситуации
- Нумерация вида 5а, 6а для отклонений от основного сценария
- Обязательные сценарии: невалидные данные, отсутствие прав доступа, системные ошибки

### 8. Поля данных
- Подробное описание всех полей согласно OpenAPI схемам
- Указание типов, форматов, обязательности, примеров
- Ссылки на соответствующие схемы в `CLM.json`

### 9. Критерии приемки
- Конкретные, проверяемые условия готовности функции
- Включают успешные и ошибочные сценарии
- Соответствие API спецификации

### 10. Диаграмма последовательности (PlantUML)
- Визуализация взаимодействий между компонентами
- Покрывает основной и минимум один альтернативный сценарий
- Соответствует архитектуре проекта

### 11. Дополнительные замечания
- Связи с другими требованиями
- Ограничения и предположения
- Технические детали реализации

## Требования к качеству

### Точность формулировок
- Используйте активный залог: "Система создает", а не "Создается"
- Избегайте неопределенности: "может", "возможно", "иногда"
- Конкретизируйте: не "обрабатывает данные", а "валидирует поле amount на положительное число"

### Техническая специфичность
- Указывайте HTTP статус-коды (200, 201, 400, 401, 403, 500)
- Ссылайтесь на конкретные поля БД и таблицы
- Используйте точные названия схем OpenAPI
- Указывайте форматы данных (UUID, ISO 8601 для дат)

### Согласованность с архитектурой
- Проверяйте соответствие `docs/architecture.md`
- Используйте существующие API endpoint'ы из `CLM.json`
- Соблюдайте модель данных из `database.dbml`
- Следуйте паттернам из уже реализованных спецификаций

### Полнота покрытия
- Каждое действие пользователя должно иметь соответствующую реакцию системы
- Все возможные ошибки должны быть документированы
- Включайте логирование и аудит согласно R-10

## Шаблон наименования файлов

Формат: `R-{номер}.md`
Примеры: `R-2.md`, `R-3.md`, `R-10.md`

## Общие принципы написания

1. **Атомарность**: Каждая спецификация описывает одно функциональное требование
2. **Тестируемость**: Все критерии приемки должны быть автоматически проверяемы
3. **Реализуемость**: Спецификация содержит достаточно деталей для разработки
4. **Трассируемость**: Четкие связи с требованиями, архитектурой и API

## Обязательные проверки перед завершением

1. Соответствие структуре из 11 разделов
2. Ссылки на существующие схемы OpenAPI работают
3. Поля данных соответствуют `CLM.json`
4. Диаграмма последовательности корректна синтаксически
5. Критерии приемки покрывают все сценарии
6. Нет противоречий с другими спецификациями

## Контекст проекта для справки

- **Архитектура**: Clean Architecture, микросервисы
- **API**: REST, OpenAPI 3.1, спецификация в `docs/specs/CLM.json`
- **База данных**: PostgreSQL, схема в `database/migrations/001_initial_schema.sql`
- **Роли**: employee, approver (team_lead, risk_officer, cfo), admin
- **Workflow**: PENDING_TEAM_LEAD → PENDING_RISK_OFFICER → [PENDING_CFO] → COMPLETED/REJECTED

Следование этим инструкциям обеспечит создание спецификаций высокого качества, пригодных для точной и эффективной разработки.