# Подход к развертыванию

## Обзор

Данный документ описывает стратегию развертывания приложения Card-Limit Manager, с фокусом на локальную среду разработки.

## Среды

Планируются следующие среды:

- **Development (Локальная)**: Для разработки и тестирования на локальных машинах разработчиков. Используется `docker-compose` для быстрого поднятия всех сервисов.
- **Staging**: Для предрелизного тестирования и демонстрации.
- **Production**: Рабочая среда для конечных пользователей.

## Технологии развертывания

- **Контейнеризация**: Все компоненты приложения будут упакованы в Docker-контейнеры.
- **Оркестрация**: Будет использоваться Kubernetes для управления контейнерами в Staging и Production средах.
- **CI/CD**: GitLab CI/CD будет использоваться для автоматизации сборки, тестирования и развертывания.

## Процесс развертывания

1.  **Сборка**: При каждом коммите в основную ветку запускается CI/CD пайплайн, который собирает Docker-образы.
2.  **Тестирование**: Автоматические тесты (unit, integration) запускаются в CI/CD пайплайне.
3.  **Развертывание в Staging**: При успешном прохождении тестов, приложение автоматически развертывается в Staging среду.
4.  **Ручное одобрение**: Перед развертыванием в Production требуется ручное одобрение.
5.  **Развертывание в Production**: После одобрения, приложение развертывается в Production среду.

## Локальная среда (Development)

- **Назначение**: Разработка и тестирование на локальных машинах разработчиков.
- **Технология**: Используется `docker-compose` для быстрого поднятия всех сервисов (Postgres, backend-сервисы, frontend, Adminer).
- **Запуск**: `docker compose up` (согласно `AGENTS.md`)

## Конфигурация и секреты (Локальная среда)

Для локальной разработки конфигурационные параметры и секреты для каждого сервиса задаются с использованием файлов `.env`.

- Каждый сервис (например, `clm`, `notif`) может иметь свой собственный файл `.env` в своей директории (например, `services/clm/.env`). Эти файлы должны быть созданы вручную разработчиком на основе примера (например, `.env.example`).
- `docker-compose.yml` будет настроен для загрузки этих `.env` файлов (через опцию `env_file`) и передачи переменных окружения в соответствующие контейнеры.
- Файлы `.env` (но не `.env.example`) добавлены в `.cursorignore` (и, следовательно, должны быть в `.gitignore`), чтобы избежать их попадания в систему контроля версий.

**Пример структуры:**

```
services/
  clm/
    .env.example  # Пример файла .env для сервиса CLM
    .env          # Локальные секреты и конфигурация для сервиса CLM (игнорируется VCS)
    Dockerfile
    main.go
  notif/
    .env.example  # Пример файла .env для сервиса NOTIF
    .env          # Локальные секреты и конфигурация для сервиса NOTIF (игнорируется VCS)
    Dockerfile
    main.go
docker-compose.yml
```

## Дальнейшие шаги (Staging и Production)

Для Staging и Production сред будут использоваться более продвинутые методы управления конфигурацией и секретами, такие как HashiCorp Vault или аналогичные решения, интегрированные с Kubernetes. Детали будут проработаны на следующих этапах.
